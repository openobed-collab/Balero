<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Balero — 15s Reset</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #0f172a;
      color: #e2e8f0;
      font-family: system-ui, sans-serif;
      overflow: hidden;
    }
    #ui {
      position: fixed;
      top: 12px;
      left: 12px;
      background: rgba(2, 6, 23, 0.6);
      border: 1px solid rgba(226,232,240,0.2);
      border-radius: 14px;
      padding: 10px 12px;
      backdrop-filter: blur(6px);
      user-select: none;
      min-width: 160px;
    }
    #ui .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    #ui .pill {
      padding: 6px 10px;
      background: rgba(30,41,59,0.8);
      border: 1px solid rgba(226,232,240,0.08);
      border-radius: 999px;
      font-size: 14px;
      line-height: 1;
    }
    #ui .score { font-weight: 700; }

    /* High Scores Box */
    #highScoresBox {
      position: fixed;
      top: 12px;
      right: 12px;
      background: rgba(2, 6, 23, 0.6);
      border: 1px solid rgba(226,232,240,0.2);
      border-radius: 14px;
      padding: 8px 10px;
      backdrop-filter: blur(6px);
      user-select: none;
      display: inline-block;
      min-width: auto;
    }
    #highScoresBox h3 {
      margin: 0 0 6px 0;
      font-size: 14px;
      font-weight: 600;
      opacity: 0.9;
      text-align: center;
      white-space: nowrap;
    }
    #topScores {
      font-size: 13px;
      line-height: 1.4;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    #topScores div {
      background: rgba(30,41,59,0.6);
      border: 1px solid rgba(226,232,240,0.08);
      border-radius: 6px;
      padding: 2px 6px;
      margin-bottom: 3px;
      text-align: center;
      min-width: 40px;
    }
    #topScores div:last-child {
      margin-bottom: 0;
    }

    #footer {
      position: fixed;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      opacity: 0.8;
      text-align: center;
      user-select: none;
      background: rgba(2, 6, 23, 0.6);
      border: 1px solid rgba(226,232,240,0.15);
      padding: 8px 12px;
      border-radius: 10px;
      backdrop-filter: blur(6px);
    }
    canvas { display: block; }
    .btn {
      padding: 6px 10px;
      background: #111827;
      color: #e5e7eb;
      border: 1px solid rgba(229,231,235,0.15);
      border-radius: 10px;
    }
    .btn:hover { filter: brightness(1.1); }
  </style>
</head>
<body>
  <canvas id="game"></canvas>

  <!-- Score + Reset box (Top Left) -->
  <div id="ui">
    <div class="row" style="gap:12px; margin-bottom:8px;">
      <span class="pill score" id="scorePill">Score: 0</span>
      <button id="resetBtn" class="btn">Reset</button>
    </div>
  </div>

  <!-- High Score box (Top Right) -->
  <div id="highScoresBox">
    <h3>High Score</h3>
    <div id="topScores">
      <div>1. —</div>
      <div>2. —</div>
      <div>3. —</div>
      <div>4. —</div>
      <div>5. —</div>
    </div>
  </div>

  <div id="footer">
    Move your mouse — you grab the <b>bottom</b> of the stick.<br/>
    Score before <b>15 seconds</b> runs out, or the game resets!
  </div>

  <script>
    (() => {
      const canvas = document.getElementById('game');
      const ctx = canvas.getContext('2d');

      let W = 0, H = 0;
      function size() {
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
      }
      window.addEventListener('resize', size);
      size();

      // Game state
      const stickLen = 120;
      const ballR = 24;
      const holeR = 10;
      const scoreThreshold = holeR + 6;
      const tipR = 6;

      let grab = { x: W * 0.5, y: H * 0.6 };
      let tip = { x: grab.x, y: grab.y - stickLen };
      let prev = { x: tip.x, y: tip.y + 160 };
      let ball = { x: tip.x, y: tip.y + 160 };
      let vx = 0, vy = 0;
      let L = 160;
      let G = 1600;
      let D = 0.985;

      let score = 0;
      let canScore = true;
      let glowUntil = 0; // timestamp until hole glows

      let topScores = [0, 0, 0, 0, 0];

      // 15 second timer
      let lastScoreTime = performance.now();
      const resetTimeout = 15000;

      function resetBall(fullReset = false) {
        if (fullReset && score > 0) {
          updateTopScores(score);
        }
        ball.x = tip.x;
        ball.y = tip.y + L;
        prev.x = ball.x;
        prev.y = ball.y;
        vx = 0; vy = 0;
        canScore = true;
        if (fullReset) {
          score = 0;
          updateScoreLabels();
        }
      }

      function updateScoreLabels() {
        document.getElementById('scorePill').textContent = 'Score: ' + score;
      }

      function updateTopScores(newScore) {
        topScores.push(newScore);
        topScores.sort((a, b) => b - a);
        topScores = topScores.slice(0, 5);
        renderTopScores();
      }

      function renderTopScores() {
        const container = document.getElementById('topScores');
        container.innerHTML = topScores
          .map((s, i) => `<div>${i + 1}. ${s > 0 ? s : '—'}</div>`)
          .join('');
      }

      function setGrab(x, y) {
        grab.x = x;
        grab.y = y;
        tip.x = grab.x;
        tip.y = grab.y - stickLen;
      }

      window.addEventListener('pointermove', (e) => {
        setGrab(e.clientX, e.clientY);
      }, { passive: true });

      document.getElementById('resetBtn').addEventListener('click', () => {
        resetBall(true);
        lastScoreTime = performance.now();
      });

      let last = performance.now();
      function frame(now) {
        const dt = Math.min(0.033, (now - last) / 1000);
        last = now;
        update(dt, now);
        draw(now);
        requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);

      function update(dt, now) {
        const x = ball.x, y = ball.y;
        vx = (ball.x - prev.x) / dt;
        vy = (ball.y - prev.y) / dt;

        vy += G * dt;
        vx *= D;
        vy *= D;

        let nx = ball.x + vx * dt;
        let ny = ball.y + vy * dt;

        // Rope constraint
        let dx = nx - tip.x;
        let dy = ny - tip.y;
        let dist = Math.hypot(dx, dy);

        const slack = 120;
        const stiffness = 0.05;

        if (dist > L) {
          const stretch = dist - L;
          nx -= (dx / dist) * stretch * stiffness;
          ny -= (dy / dist) * stretch * stiffness;
        } else if (dist < L - slack) {
          const stretch = (L - slack) - dist;
          nx += (dx / dist) * stretch * stiffness;
          ny += (dy / dist) * stretch * stiffness;
        }

        prev.x = x;
        prev.y = y;
        ball.x = nx;
        ball.y = ny;

        vx = (ball.x - prev.x) / dt;
        vy = (ball.y - prev.y) / dt;

        // Scoring
        const pdist = Math.hypot(ball.x - tip.x, ball.y - tip.y);
        if (pdist < scoreThreshold) {
          if (canScore) {
            score++;
            canScore = false;
            glowUntil = now + 1000; // glow for 1s
            updateScoreLabels();
            vy -= Math.max(80, 220 - L * 0.5);
            lastScoreTime = now;
          }
        } else {
          canScore = true;
        }

        // timeout reset
        if (now - lastScoreTime > resetTimeout) {
          resetBall(true);
          lastScoreTime = now;
        }
      }

      function draw(now) {
        ctx.fillStyle = '#0f172a';
        ctx.fillRect(0, 0, W, H);

        // Rope
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#94a3b8';
        ctx.beginPath();
        ctx.moveTo(tip.x, tip.y);
        ctx.lineTo(ball.x, ball.y);
        ctx.stroke();

        // Stick
        ctx.lineWidth = 8;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#f5deb3';
        ctx.beginPath();
        ctx.moveTo(tip.x, tip.y);
        ctx.lineTo(grab.x, grab.y);
        ctx.stroke();

        // Stick tip
        ctx.fillStyle = '#d1d5db';
        ctx.beginPath();
        ctx.arc(tip.x, tip.y, tipR, 0, Math.PI * 2);
        ctx.fill();

        // Ball
        ctx.fillStyle = '#eab308';
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ballR, 0, Math.PI * 2);
        ctx.fill();

        // Ball hole (glows white if within glow time)
        ctx.fillStyle = (now < glowUntil) ? '#ffffff' : '#0f172a';
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, holeR, 0, Math.PI * 2);
        ctx.fill();
      }

      renderTopScores();
      resetBall(true);
    })();
  </script>
</body>
</html>
